# イベント管理システム - 開発・実行手順

## 概要

このプロジェクトは、DDD/CQRS アーキテクチャに基づくイベント管理システムです。

- **バックエンド**: Go + Gin + MySQL
- **フロントエンド**: Next.js + TypeScript + Tailwind CSS
- **インフラ**: Docker Compose

## 前提条件

以下のツールがインストールされていることを確認してください：

- Docker & Docker Compose
- Go 1.23 以上
- Node.js 18 以上
- npm または yarn

## プロジェクト構成

```
MinWeb2025-event-management-system/
├── api/                    # OpenAPI仕様書
├── backend/               # Goバックエンド
│   ├── cmd/main.go       # エントリーポイント
│   ├── internal/         # 内部実装（DDD/CQRS）
│   │   ├── domain/       # ドメインモデル
│   │   ├── usecase/      # ユースケース（コマンド・クエリ）
│   │   ├── interface/    # HTTPハンドラ
│   │   └── infrastructure/ # リポジトリ実装
│   └── Dockerfile.dev    # 開発用Dockerfile
├── frontend/             # Next.jsフロントエンド
│   ├── src/app/         # App Router
│   ├── src/lib/         # ユーティリティ
│   └── Dockerfile.dev   # 開発用Dockerfile
├── scripts/             # 開発用スクリプト
└── docker-compose.yml   # 開発環境設定
```

## 開発環境の起動

### 1. 環境変数の設定（オプション）

必要に応じて`.env`ファイルを作成：

```bash
# データベース設定
DB_ROOT_PASSWORD=rootpassword
DB_DATABASE=events_db
DB_USER=events_user
DB_PASSWORD=events_password
```

### 2. Docker Compose で開発環境を起動

```bash
# 全サービスを起動（バックエンド、フロントエンド、MySQL）
docker-compose up -d

# ログを確認
docker-compose logs -f

# 特定のサービスのログを確認
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f db
```

### 3. アクセス確認

- **フロントエンド**: http://localhost:3000
- **バックエンド API**: http://localhost:8080
- **データベース**: localhost:3306

## 開発作業

### バックエンド開発

#### ローカル開発（推奨）

```bash
# バックエンドディレクトリに移動
cd backend

# 依存関係をインストール
go mod tidy

# 開発サーバーを起動
go run cmd/main.go
```

#### Docker 内での開発

```bash
# バックエンドコンテナに入る
docker-compose exec backend sh

# コンテナ内でGoコマンドを実行
go run cmd/main.go
```

### フロントエンド開発

#### ローカル開発（推奨）

```bash
# フロントエンドディレクトリに移動
cd frontend

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

#### Docker 内での開発

```bash
# フロントエンドコンテナに入る
docker-compose exec frontend sh

# コンテナ内でnpmコマンドを実行
npm run dev
```

## API 開発

### OpenAPI 仕様書の更新

```bash
# api/openapi.yamlを編集
# 仕様書を更新後、APIクライアントを再生成
```

### API クライアントの生成

```bash
# 全環境のAPIクライアントを生成
./scripts/generate-api.sh all

# バックエンドのみ
./scripts/generate-api.sh backend

# フロントエンドのみ
./scripts/generate-api.sh frontend
```

## テスト実行

### バックエンドテスト

```bash
cd backend
go test ./...
```

### フロントエンドテスト

```bash
cd frontend
npm test
```

## データベース操作

### MySQL コンテナに接続

```bash
# MySQLコンテナに入る
docker-compose exec db mysql -u events_user -p events_db

# またはrootユーザーで
docker-compose exec db mysql -u root -p
```

### データベースのリセット

```bash
# データベースボリュームを削除
docker-compose down -v

# 再起動
docker-compose up -d
```

## 本番環境向けビルド

### バックエンド

```bash
cd backend
go build -o bin/server cmd/main.go
```

### フロントエンド

```bash
cd frontend
npm run build
```

## トラブルシューティング

### よくある問題

1. **ポートが既に使用されている**

   ```bash
   # 使用中のポートを確認
   lsof -i :3000
   lsof -i :8080
   lsof -i :3306
   ```

2. **Docker コンテナが起動しない**

   ```bash
   # ログを確認
   docker-compose logs

   # コンテナを再作成
   docker-compose down
   docker-compose up --build
   ```

3. **依存関係の問題**

   ```bash
   # バックエンド
   cd backend && go mod tidy

   # フロントエンド
   cd frontend && npm install
   ```

### ログの確認

```bash
# 全サービスのログ
docker-compose logs

# リアルタイムログ
docker-compose logs -f

# 特定サービスのログ
docker-compose logs backend
docker-compose logs frontend
docker-compose logs db
```

## 開発のベストプラクティス

1. **DDD/CQRS アーキテクチャの遵守**

   - ドメインモデルは`backend/internal/domain/`に配置
   - コマンドは`backend/internal/usecase/command/`に配置
   - クエリは`backend/internal/usecase/query/`に配置

2. **API 仕様書の管理**

   - `api/openapi.yaml`を更新後は必ずクライアントを再生成
   - 仕様書と実装の整合性を保つ

3. **テストの作成**

   - 新機能追加時は必ずテストを作成
   - ドメインロジックのテストを重視

4. **環境変数の管理**
   - 機密情報は`.env`ファイルで管理
   - `.env`ファイルは Git にコミットしない

## 停止・クリーンアップ

```bash
# 開発環境を停止
docker-compose down

# ボリュームも含めて完全削除
docker-compose down -v

# イメージも削除
docker-compose down --rmi all
```
